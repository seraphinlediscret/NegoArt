YUI.add("flickr-photos-addTags-creator",function(t,o){"use strict";t.namespace("ModelCreators")["flickr-photos-addTags"]={run:function(s,e){var r=this;return t.Promise.all([e.callAPI("flickr.photos.addTags",this._processParams(s)),e.getModelRegistry("photo-tags-models"),e.getModelRegistry("tag-models")]).then(function(t){return r._processResponse(t,s)},function(t){throw s.fullResponse&&(t.photoIds=s.photoId),t}).then(null,t.FetcherErrorLogger(o))},_processParams:function(t){t.tags=t.tags||[];var o={};return o.photo_ids=t.photoId.join(","),o.tags=t.tags.join(","),t.fullResponse&&(o.full_response=1),o.extras="is_autotag",o},_processResponse:function(t,o){var s,e,r,a=t[0],n=t[1],i=t[2],d=[];if(s=a.errors,!o.fullResponse){for(a.tags.tag.forEach(function(t){i.exists(t.id)||i.add({id:t.id,tagRaw:t.raw,tagValue:t.content.replace(/\s/g,""),tagAuthorNSID:t.author,duplicateAutotagId:t.duplicateAutotag}),d.push(i.proxy(t.id))}),e=0;e<o.photoId.length;e++)r=o.photoId[e],n.exists(r)?d.forEach(function(t){void 0!==t&&n.getValue(r,"tags").push(t)}):n.add({id:r,tags:d});return d}if(s&&s.length>0)return s}}},"@VERSION@",{requires:["flickr-promise"],optional:["photo-tags-models","tag-models"]});YUI.add("vr-overlay-view",function(e,t){var i,n=require("hermes-core/flog")(t);i={css:{destinationContainer:"body",closeX:".close"},options:{}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.photoId=e.photoId,this.nsid=e.nsid,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.immersed=!1,this},subviewConfig:{},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(t){return e.set("photo",t),e.canVr().then(function(t){e.set("canVr",t)})})},buildContainer:function(){var e=this.get("canVr");return this.set("isActiveViewAgnostic",!0),e?(this.setContainerWithTemplate("vr-overlay"),this):this},buildErrorContainer:function(){this.setContainerHTML("")},activate:function(){var t=this;if(this.get("canVr"))return this.loadFlickvr().then(function(){var n=t.get("container");n.addClass("active"),n.one(i.css.closeX)&&t.registerEventHandler(n.one(i.css.closeX).on("click",e.bind(t.closeVr,t))),t.registerEventHandler(t.get("container").on("click",t.openVr,t)),t.isMobile||t.openVr()}).then(null,function(e){n.error("Failed to load flickvr from CDN",{err:e})}),this},loadFlickvr:function(){return new e.Promise(function(t,i){if(window.Flickvr)return t();e.Get.js("https://combo.staticflickr.com/ap/flickvr/version.js",function(o){return o?i():window.FlickvrVersion?void e.Get.js("https://combo.staticflickr.com/ap/flickvr/"+window.FlickvrVersion+".js",function(e){return e?i():(n.log("flickvr loaded successfully from CDN"),t())}):i()})})},hasEquirectangularTag:function(){return this.appContext.getModel("photo-tags-models",this.photoId).then(function(e){var t=!1;return e.toJSON().tags.forEach(function(e){"equirectangular"===e.tagRaw.toLowerCase()&&(t=!0)}),t})},inEquirectangularGroup:function(){return this.appContext.getModel("photo-groups-models",this.photoId).then(function(e){var t=!1;return e.toJSON().groups.forEach(function(e){"44671723@N00"===e.id&&(t=!0)}),t})},canVr:function(){var t,i,n=!1;return this.appContext.flipper.isFlipped("enable-vr")?((t=this.get("photo"))&&(i=t.getValue("aspectRatio"))&&i>=1.99&&i<=2.01&&(n=!0),n?e.Promise.all([this.appContext.callAPI("flickr.vr.isEquirectangular",{photo_id:t.id})]).then(function(t){return e.Promise.resolve(!!t[0].is_equirectangular)}):e.Promise.resolve(!1)):e.Promise.resolve(!1)},onParentViewEvent:function(e,t){if(t&&t[0])switch(t[0]){case"vrIconClicked":this.openVr();break;case"vKeyPressed":this.toggleVr()}},toggleVr:function(){this.immersed?this.closeVr():this.openVr()},openVr:function(t){if(this.immersed||t&&t.target.hasClass("close"))this.vr.controls&&this.vr.controls.autoRotate&&(this.vr.controls.autoRotate=!1);else{var i,n,o=this,r=this.get("photo").getLargestSize(),s=this.templates("flickr-balls")({}),a=new Image;t&&t.halt(),(n=e.Node.create("<div></div>")).addClass("vr-loading-layer"),n.addClass("fluid"),n.append(s),o.get("container").append(n),i=r.displayUrl,a.crossOrigin="anonymous",a.onload=function(){o.immersed=!0,o.vr=new window.Flickvr,o.vr.initialize(i,{container:o.get("container").getDOMNode(),useContainerDimensions:!o.isMobile,enableVrHeadset:o.appContext.flipper.isFlipped("enable-vr-headset"),autoRotate:!o.isMobile}).then(function(t){e.fire("photo:entering-vr"),t.style.position="absolute",o.vr.enterVR(),o.get("container").one(".vr-loading-layer").remove(),o.get("container").addClass("immersed"),o.escHandle=o.attachKeyEvent("down:27",e.betterThrottle(o.closeVr.bind(o),100))})},a.src=i}},closeVr:function(e){var t=this.get("container");e&&e.preventDefault(),this.vr&&this.vr.destroy(),this.escHandle&&(this.detachRegisteredEvent(this.escHandle),delete this.escHandle),this.immersed=!1,t.removeClass("immersed")},beforeDestroy:function(){this.set("lastContainer",this.get("container")),this.immersed&&this.closeVr()},destructor:function(){var e=this.get("lastContainer");e&&(e.remove(!0),this.set("lastContainer",null))}})},"@VERSION@",{requires:["flickr-view","better-throttle","get","hermes-template-vr-overlay","hermes-template-flickr-balls"],optional:["photo-models","photo-tags-models","photo-groups-models"],langBundles:["common","photo-page-scrappy"]});YUI.add("hermes-template-zoom",function(e,a){var r=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,r,t,m){return""},useData:!0}),t={};e.Array.each([],function(a){var r=e.Template.get("hermes/"+a);r&&(t[a]=r)}),e.Template.register("hermes/zoom",function(a,m){return m=m||{},m.partials=m.partials?e.merge(t,m.partials):t,r(a,m)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-zoom-modal",function(a,l){var e=a.Template.Handlebars.revive({1:function(a,l,e,n,r){var s;return'<img src="'+a.escapeExpression("function"==typeof(s=null!=(s=e.smallSrc||(null!=l?l.smallSrc:l))?s:e.helperMissing)?s.call(null!=l?l:{},{name:"smallSrc",hash:{},data:r}):s)+'" class="zoom-small">'},3:function(a,l,e,n,r){var s;return'<img src="'+a.escapeExpression("function"==typeof(s=null!=(s=e.largeSrc||(null!=l?l.largeSrc:l))?s:e.helperMissing)?s.call(null!=l?l:{},{name:"largeSrc",hash:{},data:r}):s)+'" class="zoom-large">'},compiler:[7,">= 4.0.0"],main:function(a,l,e,n,r){var s,t=null!=l?l:{};return'<div class="zoom-modal hidden">\n\t<div class="zoom-photo-container">\n\t\t'+(null!=(s=e.if.call(t,null!=l?l.smallSrc:l,{name:"if",hash:{},fn:a.program(1,r,0),inverse:a.noop,data:r}))?s:"")+"\n\t\t"+(null!=(s=e.if.call(t,null!=l?l.largeSrc:l,{name:"if",hash:{},fn:a.program(3,r,0),inverse:a.noop,data:r}))?s:"")+'\n\t\t<span class="facade-of-protection-zoom"></span>\n\t</div>\n</div>\n'},useData:!0}),n={};a.Array.each([],function(l){var e=a.Template.get("hermes/"+l);e&&(n[l]=e)}),a.Template.register("hermes/zoom-modal",function(l,r){return r=r||{},r.partials=r.partials?a.merge(n,r.partials):n,e(l,r)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("zoom-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,forceGpu:null,initializer:function(o){return this.photoId=o.photoId,this.disableIfSmall=!!o.disableIfSmall,YUI.Env.isServer||(e.config.win.location.search.indexOf("gpu=on")>-1?this.forceGpu=!0:e.config.win.location.search.indexOf("gpu=off")>-1&&(this.forceGpu=!1)),this},loadState:function(){var e=this;return this.appContext.getModel("photo-models",e.photoId).then(function(o){e.set("photo",o)})},buildContainer:function(){return this.setContainerWithTemplate("zoom"),this},activate:function(){var o=this,t=o.getZoomKeyScope();return this.get("photo").getValue("needsInterstitial")||(this.parentViewContainer=this.get("container").ancestor(".view"),o.registerEventHandler(o.get("container").on("click",function(t){t.preventDefault(),o.cursorCoords=[t.pageX-e.config.win.pageXOffset,t.pageY-e.config.win.pageYOffset],e.rapidTracker.beacon(o.name,"zoomInClick"),o.zoomIn(o.cursorCoords)})),o.registerEventHandler(e.on("photo:zoom",function(t){t.x&&t.y?(o.cursorCoords=[t.x-e.config.win.pageXOffset,t.y-e.config.win.pageYOffset],o.zoomIn(o.cursorCoords)):o.zoomIn(),e.rapidTracker.beacon(o.name,"zoomInRemoteFire")})),o.attachKeyEvent("down:90",e.betterThrottle(function(t){t.preventDefault(),e.rapidTracker.beacon(o.name,"zoomInKeyPress"),o.zoomIn()},100)),o.attachKeyEvent("down:90,27",e.betterThrottle(function(t){t.preventDefault(),e.rapidTracker.beacon(o.name,"zoomOutKeyPress"),o.zoomOut()},100),t),o.attachKeyEvent("down:37,38,39,40",e.betterThrottle(function(t){var n=[o.currentZoomRegion.left,o.currentZoomRegion.top];switch(t.preventDefault(),t.button){case 37:n[0]+=200;break;case 38:n[1]+=200;break;case 39:n[0]-=200;break;case 40:n[1]-=200}e.rapidTracker.beacon(o.name,"zoomPanKeyPress"),o.panZoomNode(n)},16),t),o.registerEventHandler(o.appContext.flapp.before("activeViewChange",function(t){e.fire("flickr:removeKeyEventScope",o.getZoomKeyScope()),o.detachRegisteredEvents(),o.detachEventHandlers(),o.cleanUp()}))),this},getZoomEdgeMargin:function(){return 100},panZoomNodeToCurrentCoords:function(){if(this.zoomedIn){var e=this.cursorCoords,o=this.getZoomPanCoordsForCursor(e);o&&this.panZoomNode(o)}},panZoomNode:function(e){this.currentZoomRegion.left===e[0]&&this.currentZoomRegion.top===e[1]||(e=this.constrainPanCoords(e),this.currentZoomRegion.left=e[0],this.currentZoomRegion.top=e[1],this.pendingCoords=e)},constrainPanCoords:function(e){var o,t,n=this.getZoomEdgeMargin(),i=[this.appContext.viewportData.getWidth(),this.appContext.viewportData.getHeight()],r=[this.zoomImageFullWidth,this.zoomImageFullHeight],a=[r[0]+2*n,r[1]+2*n];return 0,o=i[0]-r[0]-2*n,0,t=i[1]-r[1]-2*n,e[0]>0?e[0]=0:e[0]<o&&(e[0]=o),e[1]>0?e[1]=0:e[1]<t&&(e[1]=t),r[0]<i[0]&&(e[0]=.5*(i[0]-a[0])),r[1]<i[1]&&(e[1]=.5*(i[1]-a[1])),e},getZoomPanCoordsForCursor:function(e){if(e){var o=this.getZoomEdgeMargin(),t=[this.appContext.viewportData.getWidth(),this.appContext.viewportData.getHeight()],n=[this.zoomImageFullWidth,this.zoomImageFullHeight],i=[n[0]+2*o,n[1]+2*o],r=[e[0]/t[0],e[1]/t[1]];return[r[0]*(t[0]-i[0]),r[1]*(t[1]-i[1])]}},getZoomSmallRegion:function(){var o=this.get("container");return{left:o.getX()-e.config.win.pageXOffset-this.getZoomEdgeMargin(),top:o.getY()-e.config.win.pageYOffset-this.getZoomEdgeMargin(),width:parseInt(o.getStyle("width"),10),height:parseInt(o.getStyle("height"),10)}},resizeZoomNode:function(o,t){var n,i,r=this,a=e.config.win.performance&&e.config.win.performance.now;return t?new e.Promise(function(t,s){function h(s){var d=(function(e){var s,h=(a?e-n:Date.now()-n)/r.getZoomTransitionTime();return h>=1?(s=o,r.isAnimatingZoom=!1,setTimeout(function(){t()},r.getZoomTransitionTime())):s={left:i.left+(o.left-i.left)*h,top:i.top+(o.top-i.top)*h,width:i.width+(o.width-i.width)*h,height:i.height+(o.height-i.height)*h},s})(s);(r.zoomingIn||r.zoomingOut)&&(r.resizeZoomNode(d,!1),d!==o&&e.config.win.requestAnimationFrame(h))}r.isAnimatingZoom=!0,n=a?e.config.win.performance.now():Date.now(),i=r.currentZoomRegion,e.config.win.requestAnimationFrame(h)}):(this.currentZoomRegion=o,this.zoomPhotoContainerNode&&this.zoomPhotoContainerNode.setStyle("transform","translate("+o.left+"px, "+o.top+"px) scale("+o.width/this.zoomImageFullWidth+")"),e.Promise.resolve())},getZoomTransitionTime:function(){return 200},zoomOut:function(){var o=this,t=this.zoomNode;e.fire("flickr:removeKeyEventScope",this.getZoomKeyScope()),this.detachEventHandlers(),this.resizeZoomNode(this.getZoomSmallRegion(),!0),t.addClass("hiding"),this.zoomedIn=!1,this.zoomingIn=!1,this.zoomingOut=!0,setTimeout(function(){o.zoomingOut&&t&&t._node&&(o.parentViewContainer.removeClass("zoomed"),t.removeClass("hiding"),t.addClass("hidden"),setTimeout(function(){o.zoomingOut&&(o.cleanUp(),this.zoomingOut=!1)},200))},this.getZoomTransitionTime()+0),delete this.pendingCoords,delete this.currentCoords},detachEventHandlers:function(){this.zoomNode&&(this.zoomNode.detachAll("mousemove"),this.mouseWheelHandler&&this.mouseWheelHandler.detach(),this.touchHandlers&&(this.touchHandlers.forEach(function(e){e.detach()}),delete this.touchHandlers))},cleanUp:function(){this.zoomNode&&(this.zoomNode.remove(!0),this.zoomedIn=!1,this.zoomingIn=!1,this.zoomingOut=!1,delete this.zoomNode,delete this.zoomPhotoContainerNode,delete this.pendingCoords,delete this.currentCoords,this.zoomAnimationHandle.detach())},isImageReadyToDisplay:function(e){var o;return!!e&&(o=new Image,o.src=e,o.complete||o.naturalWidth)},getZoomKeyScope:function(){return this.name+this._yuid},zoomMouseMoveHandler:function(o){this.cursorCoords=[o.pageX-e.config.win.pageXOffset,o.pageY-e.config.win.pageYOffset],this.isAnimatingZoom||this.panZoomNodeToCurrentCoords()},zoomScrollWheelHandler:function(e){e.preventDefault();var o=e.wheelDeltaX,t=e.wheelDeltaY;void 0===o&&(o=-e.deltaX||0),void 0===t&&(t=-e.deltaY||0),this.panZoomNode([this.currentZoomRegion.left+o,this.currentZoomRegion.top+t])},getSizes:function(){var e=this.parentViewContainer.one(".low-res-photo"),o=this.parentViewContainer.one(".main-photo");return{small:e?e.getAttribute("src"):"",medium:o?o.getAttribute("src"):"",large:this.getLargestSize()}},getLargestSize:function(){var e,o=this.appContext.flipper.isFlipped("enable-zoom-proxy"),t=this.appContext.flipper.config["zoom-proxy-prefix"];return o&&t?"o"===(e=this.get("photo").getLargestSize({excludeSizes:[]})).key&&(console.log("proxyPrefix",t,"largestSize.displayUrl",e.displayUrl),e.displayUrl=e.url=t+"http:"+e.displayUrl,console.log("proxying original",e.url)):e=this.get("photo").getLargestSize(),e},zoomIn:function(o){var t,n,i,r,a,s=this,h=this.getSizes(),d=this.isImageReadyToDisplay(h.medium),m=this.isImageReadyToDisplay(h.large.url),c=this.getZoomPixelRatio(),g=this.getZoomSmallRegion(),l=this.maxMsgNode;if(this.disableIfSmall&&g.width>=h.large.width)return l||(l=this.maxMsgNode=e.Node.create('<div class="zoom-max-message">'+s.intlMessage({intlName:"photo-page-scrappy.ZOOM_MAX_MESSAGE"})+"</div>")),this.get("container").contains(l)||(l.addClass("hidden"),this.get("container").append(l)),void setTimeout(function(){l&&l.inDoc()&&(l.removeClass("hidden"),this.maxMsgNodeHidingTimer&&(clearTimeout(this.maxMsgNodeHidingTimer),delete this.maxMsgNodeHidingTimer),this.maxMsgNodeHidingTimer=setTimeout(function(){l&&l.inDoc()&&l.addClass("hidden")},3e3))},0);e.fire("flickr:setKeyEventScope",this.getZoomKeyScope()),this.zoomingIn=!0,this.zoomAnimationHandle=e.AnimationManager.subscribe(function(){var t,n,i=s.getDeteriorationRateForEasing(),r={x:0,y:0},a={x:0,y:0},h={x:0,y:0};s.pendingCoords&&(r.x=parseInt(s.pendingCoords[0],10),r.y=parseInt(s.pendingCoords[1],10),s.currentCoords?(a.x=s.currentCoords[0],a.y=s.currentCoords[1]):(t=s.getZoomPanCoordsForCursor(o),n=s.constrainPanCoords(t),a.x=parseInt(n[0],10),a.y=parseInt(n[1],10)),r.x<a.x?h.x=a.x-Math.abs(r.x-a.x)*i:h.x=a.x+Math.abs(r.x-a.x)*i,r.y<a.y?h.y=a.y-Math.abs(r.y-a.y)*i:h.y=a.y+Math.abs(r.y-a.y)*i,h.x=parseInt(h.x,10),h.y=parseInt(h.y,10),h.x===a.x&&(r.x<a.x?h.x=a.x-1:r.x>a.x&&(h.x=a.x+1)),h.y===a.y&&(r.y<a.y?h.y=a.y-1:r.y>a.y&&(h.y=a.y+1)),h.x===r.x&&h.y===r.y||((!0===s.forceGpu||e.config.win.devicePixelRatio>1)&&!1!==s.forceGpu?s.zoomPhotoContainerNode.setStyle("transform","translate3d("+h.x+"px, "+h.y+"px, 0)"):s.zoomPhotoContainerNode.setStyle("transform","translate("+h.x+"px, "+h.y+"px)")),s.currentCoords=[h.x,h.y],h.x===r.x&&h.y===r.y&&delete s.pendingCoords)}),this.zoomNode?(this.zoomingOut=!1,(t=this.zoomNode).removeClass("hiding"),this.detachEventHandlers()):t=this.zoomNode=e.Node.create(this.templates("zoom-modal")({smallSrc:d?h.medium:h.small,largeSrc:m?h.large.url:""})),n=this.zoomPhotoContainerNode=t.one(".zoom-photo-container"),this.zoomImageFullWidth=h.large.width/c,this.zoomImageFullHeight=h.large.height/c,o||(o=[this.appContext.viewportData.viewport.width/2,this.appContext.viewportData.viewport.height/2],s.cursorCoords=o),i=this.getZoomPanCoordsForCursor(o),i=this.constrainPanCoords(i),r={left:i[0],top:i[1],width:this.zoomImageFullWidth,height:this.zoomImageFullHeight},n.setStyle("transition","none"),this.resizeZoomNode(g,!1),t.on("click",function(o){s.zoomingIn||(o.preventDefault(),e.rapidTracker.beacon(s.name,"zoomOutClick"),s.zoomOut())}),e.one("body").append(t),n.setStyle("width",r.width),n.setStyle("height",r.height),e.soon(function(){s.zoomingIn&&(t.removeClass("hidden"),n.setStyle("transition",""),"ontouchstart"in document&&e.use("event-touch",function(){s.touchHandlers=[],s.touchHandlers.push(e.on("touchstart",function(e){e.changedTouches.length&&1===e.changedTouches.length&&(s.touching=[e.changedTouches[0].pageX,e.changedTouches[0].pageY])})),s.touchHandlers.push(e.on("touchmove",function(e){var o,t,n=e.pageX,i=e.pageY;s.touching&&e.changedTouches.length&&1===e.changedTouches.length&&(n=e.changedTouches[0].pageX,i=e.changedTouches[0].pageY,e.preventDefault(),o=n-s.touching[0],t=i-s.touching[1],s.touching=[n,i],s.panZoomNode([s.currentZoomRegion.left+o,s.currentZoomRegion.top+t]))})),s.touchHandlers.push(e.on("touchend",function(e){delete s.touching}))}),"ontouchstart"in document&&!s.appContext.flipper.isFlipped("enable-always-bind-mouse-events-zoom-view")||(t.on("mousemove",s.zoomMouseMoveHandler.bind(s)),s.mouseWheelHandler=(function(){var e=s.zoomScrollWheelHandler.bind(s);return a="onwheel"in document.createElement("div")?"wheel":"mousewheel",s.zoomNode.getDOMNode().addEventListener(a,e,!1),{detach:function(){s.zoomNode.getDOMNode().removeEventListener(a,e,!1)}}})()),s.parentViewContainer.addClass("zoomed"),s.resizeZoomNode(r,!0).then(function(){s.zoomingIn&&(s.zoomingIn=!1,s.zoomedIn=!0,s.panZoomNodeToCurrentCoords(),m||n.append('<img src="'+h.large.url+'" class="zoom-large">'))}))})},getDeteriorationRateForEasing:function(){return.2},getZoomPixelRatio:function(){return 1}})},"@VERSION@",{requires:["flickr-view","better-throttle","flickr-promise","hermes-template-zoom","hermes-template-zoom-modal","animation-manager"],optional:["photo-models"],langBundles:["photo-page-scrappy"]});YUI.add("hermes-template-photo-well-media-scrappy",function(t,a){var e=t.Template.Handlebars.revive({1:function(t,a,e,l,n){var i,s=null!=a?a:{};return'\t<div class="restricted-interstitial">\n\t\t<div class="restricted-interstitial-message">\n\t\t\t<h2>'+t.escapeExpression((e.intlMessage||a&&a.intlMessage||e.helperMissing).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADULT_CONTENT"},data:n}))+"</h2>\n"+(null!=(i=e.if.call(s,null!=a?a.isSignedIn:a,{name:"if",hash:{},fn:t.program(2,n,0),inverse:t.program(5,n,0),data:n}))?i:"")+"\t\t</div>\n\t</div>\n"},2:function(t,a,e,l,n){var i,s=null!=a?a:{},h=e.helperMissing,r=t.escapeExpression;return"\t\t\t\t<p>"+r((e.intlMessage||a&&a.intlMessage||h).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.MATURE_AUDIENCES"},data:n}))+"<br />"+r((e.intlMessage||a&&a.intlMessage||h).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.USER_DISCRETION"},data:n}))+"</p>\n\n"+(null!=(i=e.unless.call(s,null!=a?a.isMinor:a,{name:"unless",hash:{},fn:t.program(3,n,0),inverse:t.noop,data:n}))?i:"")},3:function(t,a,e,l,n){var i=null!=a?a:{},s=e.helperMissing,h=t.escapeExpression;return"\t\t\t\t\t<p><button class='ui-button'><span>"+h((e.intlMessage||a&&a.intlMessage||s).call(i,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SHOW_ME_THIS_CONTENT_TYPE"},data:n}))+"</span></button></p>\n\t\t\t\t\t<p>"+h((e.intlHTMLMessage||a&&a.intlHTMLMessage||s).call(i,{name:"intlHTMLMessage",hash:{intlName:"photo-page-scrappy.CHANGE_SAFE_SEARCH_IN_SETTINGS"},data:n}))+"</p>\n"},5:function(t,a,e,l,n){var i,s=null!=a?a:{},h=e.helperMissing,r=t.escapeExpression;return"\t\t\t\t<p>"+r((e.intlMessage||a&&a.intlMessage||h).call(s,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.SIGNED_IN_FOR_CONTENT"},data:n}))+' <a href="//'+r("function"==typeof(i=null!=(i=e.host||(null!=a?a.host:a))?i:h)?i.call(s,{name:"host",hash:{},data:n}):i)+'/signin/" data-track="photoWellSignInClick">'+r((e.intlMessage||a&&a.intlMessage||h).call(s,{name:"intlMessage",hash:{intlName:"common.SIGN_IN"},data:n}))+"</a></p>\n"},7:function(t,a,e,l,n){var i;return null!=(i=e.if.call(null!=a?a:{},null!=a?a.isVideo:a,{name:"if",hash:{},fn:t.program(8,n,0),inverse:t.program(10,n,0),data:n}))?i:""},8:function(t,a,e,l,n){var i,s=null!=a?a:{},h=e.helperMissing,r=t.escapeExpression;return'\t\t<div class="videoplayer main-photo" style="width:'+r("function"==typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)?i.call(s,{name:"width",hash:{},data:n}):i)+"px; height:"+r("function"==typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)?i.call(s,{name:"height",hash:{},data:n}):i)+'px;"><video id="video_1" poster="'+r("function"==typeof(i=null!=(i=e.src||(null!=a?a.src:a))?i:h)?i.call(s,{name:"src",hash:{},data:n}):i)+'" class="video-js vjs-big-play-centered inherit-size"></video></div>\n'},10:function(t,a,e,l,n){var i;return"\n"+(null!=(i=e.if.call(null!=a?a:{},null!=a?a.showFuzzy:a,{name:"if",hash:{},fn:t.program(11,n,0),inverse:t.program(13,n,0),data:n}))?i:"")},11:function(t,a,e,l,n){var i,s=null!=a?a:{},h=e.helperMissing,r=t.escapeExpression;return'\t\t<span class="restricted-image main-photo" style="width:'+r("function"==typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)?i.call(s,{name:"width",hash:{},data:n}):i)+"px;height:"+r("function"==typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)?i.call(s,{name:"height",hash:{},data:n}):i)+'px;">\n\t\t</span>\n'},13:function(t,a,e,l,n){var i,s=null!=a?a:{},h=e.helperMissing,r="function",o=t.escapeExpression;return'\t\t<span class="facade-of-protection-neue" style="width:'+o(typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)===r?i.call(s,{name:"width",hash:{},data:n}):i)+"px;height:"+o(typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)===r?i.call(s,{name:"height",hash:{},data:n}):i)+'px;">\n\t\t\t'+o((e.outlet||a&&a.outlet||h).call(s,null!=a?a["zoom-view"]:a,{name:"outlet",hash:{},data:n}))+"\n\t\t\t"+o((e.outlet||a&&a.outlet||h).call(s,null!=a?a["vr-overlay-view"]:a,{name:"outlet",hash:{},data:n}))+'\n\t\t</span>\n\n\t\t<img width="'+o(typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)===r?i.call(s,{name:"width",hash:{},data:n}):i)+'" height="'+o(typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)===r?i.call(s,{name:"height",hash:{},data:n}):i)+'" src="'+o(typeof(i=null!=(i=e.src||(null!=a?a.src:a))?i:h)===r?i.call(s,{name:"src",hash:{},data:n}):i)+'" class="low-res-photo" alt="'+o(typeof(i=null!=(i=e.imgAltText||(null!=a?a.imgAltText:a))?i:h)===r?i.call(s,{name:"imgAltText",hash:{},data:n}):i)+'">\n\t\t<img width="'+o(typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)===r?i.call(s,{name:"width",hash:{},data:n}):i)+'" height="'+o(typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)===r?i.call(s,{name:"height",hash:{},data:n}):i)+'" src="'+o(typeof(i=null!=(i=e.highResSrc||(null!=a?a.highResSrc:a))?i:h)===r?i.call(s,{name:"highResSrc",hash:{},data:n}):i)+'" class="main-photo is-hidden" alt="'+o(typeof(i=null!=(i=e.imgAltText||(null!=a?a.imgAltText:a))?i:h)===r?i.call(s,{name:"imgAltText",hash:{},data:n}):i)+'">\n\t\t<script nonce="'+o(typeof(i=null!=(i=e.cspNonce||(null!=a?a.cspNonce:a))?i:h)===r?i.call(s,{name:"cspNonce",hash:{},data:n}):i)+"\">\n\t\tvar img = document.querySelector('.photo-well-media-scrappy-view img.main-photo');\n\t\timg.onload = function () { registerFirstPhoto(img); };\n\t\t<\/script>\n\t\t<noscript>\n\t\t\t<img width=\""+o(typeof(i=null!=(i=e.width||(null!=a?a.width:a))?i:h)===r?i.call(s,{name:"width",hash:{},data:n}):i)+'" height="'+o(typeof(i=null!=(i=e.height||(null!=a?a.height:a))?i:h)===r?i.call(s,{name:"height",hash:{},data:n}):i)+'" src="'+o(typeof(i=null!=(i=e.highResSrc||(null!=a?a.highResSrc:a))?i:h)===r?i.call(s,{name:"highResSrc",hash:{},data:n}):i)+'" class="main-photo" alt="'+o(typeof(i=null!=(i=e.imgAltText||(null!=a?a.imgAltText:a))?i:h)===r?i.call(s,{name:"imgAltText",hash:{},data:n}):i)+'">\n\t\t</noscript>\n'},compiler:[7,">= 4.0.0"],main:function(t,a,e,l,n){var i;return null!=(i=e.if.call(null!=a?a:{},null!=a?a.needsInterstitial:a,{name:"if",hash:{},fn:t.program(1,n,0),inverse:t.program(7,n,0),data:n}))?i:""},useData:!0}),l={};t.Array.each([],function(a){var e=t.Template.get("hermes/"+a);e&&(l[a]=e)}),t.Template.register("hermes/photo-well-media-scrappy",function(a,n){return n=n||{},n.partials=n.partials?t.merge(l,n.partials):l,e(a,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-google-moola-position",function(a,l){var e=a.Template.Handlebars.revive({1:function(a,l,e,n,t){return"upsell-fallback"},3:function(a,l,e,n,t){var i;return"width: "+a.escapeExpression("function"==typeof(i=null!=(i=e.adWidth||(null!=l?l.adWidth:l))?i:e.helperMissing)?i.call(null!=l?l:{},{name:"adWidth",hash:{},data:t}):i)+"px;"},5:function(a,l,e,n,t){var i;return"height: "+a.escapeExpression("function"==typeof(i=null!=(i=e.adHeight||(null!=l?l.adHeight:l))?i:e.helperMissing)?i.call(null!=l?l:{},{name:"adHeight",hash:{},data:t}):i)+"px;"},7:function(a,l,e,n,t){return'\t\t<a href="/account/upgrade/pro?feed"></a>\n'},compiler:[7,">= 4.0.0"],main:function(a,l,e,n,t){var i,r,s=null!=l?l:{},o=e.helperMissing,u=a.escapeExpression;return'<div class="g-moola-container '+u("function"==typeof(r=null!=(r=e.class||(null!=l?l.class:l))?r:o)?r.call(s,{name:"class",hash:{},data:t}):r)+" "+(null!=(i=e.if.call(s,null!=l?l.upsellFallback:l,{name:"if",hash:{},fn:a.program(1,t,0),inverse:a.noop,data:t}))?i:"")+"\" id='"+u("function"==typeof(r=null!=(r=e.adDiv||(null!=l?l.adDiv:l))?r:o)?r.call(s,{name:"adDiv",hash:{},data:t}):r)+"' style='"+(null!=(i=e.if.call(s,null!=l?l.adWidth:l,{name:"if",hash:{},fn:a.program(3,t,0),inverse:a.noop,data:t}))?i:"")+" "+(null!=(i=e.if.call(s,null!=l?l.adHeight:l,{name:"if",hash:{},fn:a.program(5,t,0),inverse:a.noop,data:t}))?i:"")+" "+u("function"==typeof(r=null!=(r=e.extraStyles||(null!=l?l.extraStyles:l))?r:o)?r.call(s,{name:"extraStyles",hash:{},data:t}):r)+"'>\n"+(null!=(i=e.if.call(s,null!=l?l.upsellFallback:l,{name:"if",hash:{},fn:a.program(7,t,0),inverse:a.noop,data:t}))?i:"")+"</div>\n"},useData:!0}),n={};a.Array.each([],function(l){var e=a.Template.get("hermes/"+l);e&&(n[l]=e)}),a.Template.register("hermes/google-moola-position",function(l,t){return t=t||{},t.partials=t.partials?a.merge(n,t.partials):n,e(l,t)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-well-media-scrappy-view",function(e,t){var i,n=require("hermes-core/flog")(t);i={photo:{render:function(){var t,i,n,o=this,s=this.get("photo"),a="";return o.preloadImage&&(o.preloadImage.onload=null),this.appContext.forceServerRender?i=t=this.getPhotoForDisplay({canvas:{width:Number.MAX_VALUE,height:Number.MAX_VALUE}}):(t=this.getPhotoForDisplay(),i=this.getPhotoForDisplay({includeSizes:["sq","q","t","s","n"]})),s.getValue("owner")&&(a=""===s.getValue("title").trim()?this.intlMessage({intlName:"common.UNTITLED"}):s.getValue("title"),a+=" | "+this.intlMessage({intlName:"common.BY_USER",user:s.getValue("owner").getValue("username")})),(n=this.get("container").one(".main-photo"))&&parseInt(n.getAttribute("width"),10)===t.width&&parseInt(n.getAttribute("height"),10)===t.height||this.setContainerWithTemplate("photo-well-media-scrappy",{width:t.width,height:t.height,src:i.url,highResSrc:t.url,imgAltText:a,needsInterstitial:s.getValue("needsInterstitial"),isSignedIn:this.appContext.getViewer().signedIn,isVideo:!1,isMinor:this.appContext.getViewer().isMinor}),YUI.Env.isServer?(this.serverWidth=t.width,this.serverHeight=t.height):s.getValue("needsInterstitial")||(o.preloadImage=new Image,o.preloadImage.onload=function(){if(!this.onloadFired&&o.isActiveAndInDOM()){this.onloadFired=!0;var i,n="photoPageShowedSize",s="ø";try{(i=/(?:_([a-z]))?\.jpg/.exec(t.url))&&i[1]&&(s=i[1])}catch(e){}finally{n+=String(s).toUpperCase()}e.rapidTracker.beacon(this.name,n);var a=o.get("container").one(".low-res-photo");o.get("container").one(".main-photo").removeClass("is-hidden").show(),a.hide()}},o.preloadImage.src=t.url,o.preloadImage.complete&&o.preloadImage.onload()),this}},video:{render:function(){var e=this.get("photo"),t=this.getPhotoForDisplay({excludeSizes:[]}),i=t.url;return this.appContext.flipper.isFlipped("disable-video-playback")&&(i="/images/en-us/video-unavailable.png"),!this.player||e.getValue("isVideoPending")||e.getValue("isVideoFailed")?(this.setContainerWithTemplate("photo-well-media-scrappy",{width:t.width,height:t.height,src:i,needsInterstitial:e.getValue("needsInterstitial"),isVideo:!0,isSignedIn:this.appContext.getViewer().signedIn,"zoom-view":""}),this):(e.getValue("isVideoPending")||e.getValue("isVideoFailed")||(this.player.dimension?(this.player.dimension("width",t.width),this.player.dimension("height",t.height)):this.player.resize(t.width,t.height)),this)}},ad:{render:function(){var t,i=e.config.flickr.moola.positions.interstitials[0];return this.adId=e.guid(),t={adDiv:i.ad_div},1===i.ad_sizes.length&&(t.upsellFallback=!1,t.adHeight=i.ad_sizes[0].ad_height,t.adWidth=i.ad_sizes[0].ad_width),this.setContainerWithTemplate("google-moola-position",t),window.googletag.cmd.push(function(){window.googletag.display(i.ad_div)}),this}}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"zoom-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"vr-overlay-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0,destinationContainer:".photo-well-media-scrappy-view",disabled:function(){return!this.appContext.flipper.isFlipped("enable-vr")}}},initializer:function(e){return this.photoId=e.photoId,this.isAd=!!e.ad,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},loadState:function(){var t=this;return this.appContext.getModel("photo-models",t.photoId).then(function(i){if(t.set("photo",i),i.getValue("isVideo"))return new e.Promise(function(t,i){e.use("flickr-video-player",function(){t()})})})},buildContainer:function(){return YUI.Env.isServer||this.set("clientRendered",!0),this.isAd?i.ad.render.call(this):i[this.get("photo").getValue("isVideo")?"video":"photo"].render.call(this),!YUI.Env.isServer&&this.subviews["vr-overlay-view"]&&this.subviews["vr-overlay-view"].get("canVr")&&this.subviews["zoom-view"]&&(this.canVR=!0,this.subviews["zoom-view"].destroy({remove:!0})),this.get("photo").getValue("needsInterstitial")?this.get("container").addClass("has-interstitial"):this.get("container").removeClass("has-interstitial"),this},handleInterstitialDismissButtonClick:function(t){var i=this,o=this.get("personPreferences"),s=this.get("photo"),a=s.getValue("safetyLevel");e.rapidTracker.beacon(this.name,"restrictedContentInterstitialClick"),o.setValue("safeSearch",a),o.registry.remoteUpdate(i.appContext.auth.user.nsid).then(function(e){s.registry.attributeSearch({needsInterstitial:!0}).forEach(function(e){s.registry.getValue(e,"safetyLevel")<=o.getValue("safeSearch")&&s.registry.setValue(e,"needsInterstitial",!1)}),i.buildContainer(),i.fire("subviewViewEvent","photoWellResized")},function(e){n.error({err:e}),i.onError(i.intlMessage({intlName:"photo-page-scrappy.COULDNT_UPDATE_SETTINGS"}))})},onParentViewEvent:function(e,t){t&&"photoWellResized"===t[0]&&(this.get("photo").getValue("needsInterstitial")||(this.set("canvasSizeIsDirty",!0),this.buildContainer()))},activate:function(){var t=this;return!this.get("photo").getValue("isVideo")||this.get("photo").getValue("isVideoPending")||this.get("photo").getValue("isVideoFailed")||(t.player=new e.FlickrVideoPlayer({container:t.get("container").one(".videoplayer"),model:t.get("photo"),appContext:t.appContext,videoNode:e.one("#video_1")?e.one("#video_1")._node:null,controlBar:{fullscreenToggle:!1}}),t.player.init().then(function(){}),t.on("destroy",function(){t.player&&(t.player.destroy(),t.player=null)})),this.get("photo").getValue("needsInterstitial")||this.registerEventHandler(e.on("flickr:photo-media-well-update",function(e){t.set("canvasSizeIsDirty",!0),t.buildContainer()})),this.appContext.getViewer().signedIn&&this.appContext.getModel("person-preferences-models",t.appContext.auth.user.nsid).then(function(e){t.set("personPreferences",e),t.get("photo").getValue("needsInterstitial")&&!this.appContext.getViewer().isMinor&&t.get("container").one(".restricted-interstitial-message button")&&t.registerEventHandler(t.get("container").one(".restricted-interstitial-message button").on("click",t.handleInterstitialDismissButtonClick,t))}),this},showUpsell:function(){var e=this.get("container"),t=e.one("#interstitial-photo-upsell"),i=e.one("iframe");t&&t.addClass("show-upsell"),i&&i.setStyle("display","none")},onError:function(t){new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,showBodyLines:!0,showCancelButton:!1,showCancelX:!0,title:this.intlMessage({intlName:"common.ERROR"}),actionButtonLabel:this.intlMessage({intlName:"common.OK"}),message:t,classList:"scrappy-dialog"}).show()},getPhotoForDisplay:function(e){var t,i,n,o=this.getCanvasSize(),s=this.getPixelRatio();return e&&e.canvasSize&&(o=e.canvasSize),t=this.get("photo").getSizeToFit(o,e),i=Math.min(o.height/s,t.height),n=Math.min(o.width/s,t.width/t.height*i),i=Math.min(i,t.height/t.width*n),{width:Math.round(n),height:Math.round(i),url:t.url,pixelRatio:t.width/n}},getCanvasSize:function(){var e,t,i,n,o,s,a=this.getPixelRatio(),r=this.get("container"),h={width:500,height:500};return this.get("canvasSizeIsDirty")?YUI.Env.isServer||(t=this.get("container").ancestor(),i=r.getStyle("paddingTop")?parseInt(r.getStyle("paddingTop").match(/[0-9]+/)[0],10):0,n=r.getStyle("paddingBottom")?parseInt(r.getStyle("paddingBottom").match(/[0-9]+/)[0],10):0,s=40,o=40,t&&((e=t.get("region")).height=parseInt(t.getStyle("height").match(/[0-9]+/)[0],10)-(i+n),e.width=this.appContext.viewportData.viewport.width-(s+o))):e=this.get("cachedCanvasSize"),this.appContext.viewportData.viewport.width>0&&(h={width:this.appContext.viewportData.viewport.width,height:this.appContext.viewportData.viewport.height-240}),e||(e={top:0,left:0,bottom:500,right:500,width:h.width,height:h.height}),e.height*=a,e.width*=a,e},getPixelRatio:function(){return this.appContext.getViewer().getPixelRatio()}},{ATTRS:{canvasSizeIsDirty:{value:!0,setter:function(e){return!!e}},cachedCanvasSize:{getter:function(t){return e.merge(t)},setter:function(t){return e.merge(t)}}}})},"@VERSION@",{requires:["flickr-view","moment","vr-overlay-view","zoom-view","hermes-template-photo-well-media-scrappy","hermes-template-google-moola-position"],optional:["photo-models"],langBundles:["common","photo-page-scrappy"]});