YUI.add("hermes-template-search-photos-albums",function(l,a){var n=l.Template.Handlebars.revive({1:function(l,a,n,e,s){var t,r=null!=a?a:{};return'\t<h5 class="search-results-header">'+(null!=(t=n.unless.call(r,null!=a?a.loading:a,{name:"unless",hash:{},fn:l.program(2,s,0),inverse:l.noop,data:s}))?t:"")+l.escapeExpression((n.intlMessage||a&&a.intlMessage||n.helperMissing).call(r,{name:"intlMessage",hash:{intlName:"search.YOUR_ALBUMS"},data:s}))+" "+(null!=(t=n.if.call(r,null!=a?a.loading:a,{name:"if",hash:{},fn:l.program(8,s,0),inverse:l.noop,data:s}))?t:"")+"</h5>\n"+(null!=(t=n.if.call(r,null!=a?a.loading:a,{name:"if",hash:{},fn:l.program(10,s,0),inverse:l.program(12,s,0),data:s}))?t:"")},2:function(l,a,n,e,s){var t;return null!=(t=n.if.call(null!=a?a:{},null!=a?a.viewingAll:a,{name:"if",hash:{},fn:l.program(3,s,0),inverse:l.program(5,s,0),data:s}))?t:""},3:function(l,a,n,e,s){return'<span class="secondary">'+l.escapeExpression((n.intlHTMLMessage||a&&a.intlHTMLMessage||n.helperMissing).call(null!=a?a:{},{name:"intlHTMLMessage",hash:{count:null!=a?a.total:a,intlName:"search.RESULTS_COUNT"},data:s}))+"</span>"},5:function(l,a,n,e,s){var t;return null!=(t=n.unless.call(null!=a?a:{},null!=a?a.singleResult:a,{name:"unless",hash:{},fn:l.program(6,s,0),inverse:l.noop,data:s}))?t:""},6:function(l,a,n,e,s){var t,r=null!=a?a:{},i=n.helperMissing,u=l.escapeExpression;return'<a href="'+u("function"==typeof(t=null!=(t=n.viewAllLink||(null!=a?a.viewAllLink:a))?t:i)?t.call(r,{name:"viewAllLink",hash:{},data:s}):t)+'" class="view-more-link" data-track="search-viewall-albums">'+u((n.intlHTMLMessage||a&&a.intlHTMLMessage||i).call(r,{name:"intlHTMLMessage",hash:{count:null!=a?a.total:a,intlName:"search.VIEW_ALL_COUNT"},data:s}))+"</a>"},8:function(l,a,n,e,s){return'<div class="flickr-dots inline"></div>'},10:function(l,a,n,e,s){var t;return'\t\t<div style="height: '+l.escapeExpression("function"==typeof(t=null!=(t=n.placeholderHeight||(null!=a?a.placeholderHeight:a))?t:n.helperMissing)?t.call(null!=a?a:{},{name:"placeholderHeight",hash:{},data:s}):t)+'px;"></div>\n'},12:function(l,a,n,e,s){var t,r=null!=a?a:{};return'\t\t<div class="results'+(null!=(t=n.unless.call(r,null!=a?a.viewingAll:a,{name:"unless",hash:{},fn:l.program(13,s,0),inverse:l.noop,data:s}))?t:"")+'">\n'+(null!=(t=n.each.call(r,null!=a?a.albums:a,{name:"each",hash:{},fn:l.program(15,s,0),inverse:l.noop,data:s}))?t:"")+"\t\t</div>\n"},13:function(l,a,n,e,s){return" unified"},15:function(l,a,n,e,s){var t,r,i=null!=a?a:{},u=n.helperMissing,o=l.escapeExpression;return'\t\t\t\t<a href="'+o("function"==typeof(r=null!=(r=n.url||(null!=a?a.url:a))?r:u)?r.call(i,{name:"url",hash:{},data:s}):r)+'"><div class="avatar album huge" style="background-image:url('+o(l.lambda(null!=(t=null!=(t=null!=a?a.primaryPhotoSizes:a)?t.q:t)?t.src:t,a))+')">\n\t\t\t\t\t<sup>'+o("function"==typeof(r=null!=(r=n.title||(null!=a?a.title:a))?r:u)?r.call(i,{name:"title",hash:{},data:s}):r)+"</sup>\n\t\t\t\t\t<sub>"+o((n.intlHTMLMessage||a&&a.intlHTMLMessage||u).call(i,{name:"intlHTMLMessage",hash:{count:null!=a?a.photoCount:a,intlName:"search.GROUP_PHOTO_COUNT"},data:s}))+"</sub>\n\t\t\t\t</div></a>\n"},compiler:[7,">= 4.0.0"],main:function(l,a,n,e,s){var t;return null!=(t=n.unless.call(null!=a?a:{},null!=a?a.emptySearch:a,{name:"unless",hash:{},fn:l.program(1,s,0),inverse:l.noop,data:s}))?t:""},useData:!0}),e={};l.Array.each([],function(a){var n=l.Template.get("hermes/"+a);n&&(e[a]=n)}),l.Template.register("hermes/search-photos-albums",function(a,s){return s=s||{},s.partials=s.partials?l.merge(e,s.partials):e,n(a,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("search-photos-albums-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,emptySearch:!1,initializer:function(t){return""===this.get("container").get("innerHTML")&&this.setContainerWithTemplate("search-photos-albums",{loading:!0,placeholderHeight:120}),this.unifiedSubviewParams=t.unifiedSubviewParams||{},this.unifiedSubviewParams.albums&&this.unifiedSubviewParams.albums.fetchParams?(this.fetchParams=this.unifiedSubviewParams.albums.fetchParams,this.apiParams=e.merge(this.fetchParams.apiParams||{}),this.searchId=this.unifiedSubviewParams.albums.id):(this.apiParams={},this.fetchParams={}),this.searchUrl=new e.SearchUrl(this.apiParams,this.appContext,e.SearchUrl.searchTypes.PHOTOS),this.viewingAll=this.apiParams[e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll],this.albumWidth=0,this.albumMarginWidth=0,this.albumResultsContainer=null,this},loadState:function(){var e,t,i=this;return this.appContext.getModel("search-sets-models",this.searchId||this.searchUrl.getId(),this.fetchParams).then(function(a){(e=a.getValue("sets"))&&(t=e.toJSON()).length<1&&(i.emptySearch=!0),i.searchModel=a})},buildContainer:function(){var t;return this.searchUrl.setAPIParam(e.SearchHelper.UNIFIED_STATE_PARAMS.albums,!0),this.searchUrl.setAPIParam(e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll,!0),t={albums:this.searchModel.getValue("sets").toJSON(),total:this.searchModel.getValue("totalItems"),singleResult:1===this.searchModel.getValue("totalItems"),emptySearch:this.emptySearch,viewAllLink:this.searchUrl.getURL(),viewingAll:this.viewingAll},this.setContainerWithTemplate("search-photos-albums",t),this},activate:function(){var t=this.get("container").one(".album");return!this.viewingAll&&t&&(this.albumWidth=t.get("offsetWidth"),this.albumMarginWidth=parseInt(t.getStyle("marginRight").replace("px",""))+parseInt(t.getStyle("marginLeft").replace("px","")),this.albumMarginWidth+=5,this.albumWidth+=this.albumMarginWidth,this.albumResultsContainer=this.get("container").one(".results"),this.registerEventHandler(e.globalEvents.subscribe("window:resize",this.quantizeContainerWidth.bind(this))),this.quantizeContainerWidth(null)),this},quantizeContainerWidth:function(e){var t,i=this.get("container").get("clientWidth");t=i-(i+this.albumMarginWidth)%this.albumWidth,this.albumResultsContainer.setStyle("width",t+"px")}},{ATTRS:{}})},"@VERSION@",{requires:["flickr-view","flickr-promise","search-sets-models","search-url","search-helper","hermes-template-search-photos-albums"],optionalRequires:["global-events"],langBundles:["search","common"]});YUI.add("search-photos-yours-view",function(e){var i={"photo-models":{name:"photo-list-photo-view",params:{excludePeople:!1,searchSimilar:!0,searchSimilarWithTerm:!0}},"photo-lite-models":{name:"photo-list-photo-view",params:{excludePeople:!1,searchSimilar:!0,searchSimilarWithTerm:!0}}},t={jst:{rowHeight:150,subviewMapping:i},thm:{rowHeight:120,forceAspectRatio:1,subviewMapping:i},til:{rowHeight:210,forceAspectRatio:1,subviewMapping:{"photo-models":{name:"photo-list-tile-view",params:{excludePeople:!1,showDescription:!1,searchSimilar:!0,searchSimilarWithTerm:!0}},"photo-lite-models":{name:"photo-list-tile-view",params:{excludePeople:!1,showDescription:!1,searchSimilar:!0,searchSimilarWithTerm:!0}}}},desc:{rowHeight:210,itemSpacing:{horizontal:4,vertical:70},subviewMapping:{"photo-models":{name:"photo-list-description-view"},"photo-lite-models":{name:"photo-list-description-view"}}}};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,emptySearch:!1,initializer:function(i){var a,s,o,r,h;if(r=i.rowHeightMod||1,"til"===i.viewType&&(r=Math.max(1,i.rowHeightMod)),""===this.get("container").get("innerHTML")&&this.setContainerWithTemplate("search-photos-single-row",{loading:!0,title:this.intlMessage({intlName:"search.YOUR_PHOTOS"}),placeholderHeight:t[i.viewType].rowHeight*r}),this.unifiedSubviewParams=i.unifiedSubviewParams||{},this.unifiedSubviewParams.yours&&this.unifiedSubviewParams.yours.fetchParams?(this.fetchParams=this.unifiedSubviewParams.yours.fetchParams,this.apiParams=e.merge(this.fetchParams.apiParams||{}),this.searchId=this.unifiedSubviewParams.yours.id,this.title=this.unifiedSubviewParams.yours.title):(this.apiParams={},this.fetchParams={}),this.searchUrl=new e.SearchUrl(this.apiParams,this.appContext,e.SearchUrl.searchTypes.PHOTOS),a=t[i.viewType].forceAspectRatio,s=e.clone(t[i.viewType].subviewMapping),o=e.clone(t[i.viewType].itemSpacing),i.photoListConfig={modelParams:{registryName:"search-photos-lite-models",modelIdOrAttributes:this.searchId||this.searchUrl.getId(),collectionAttributeName:"photos",fetchParams:this.fetchParams},pageParams:e.merge(this.fetchParams),paginateOnScroll:!1,keepAwakeOnScroll:!0,parentName:this.name,engagementModelName:"photo-lite-models",injectPhotolistContextParams:{rapidBeaconConfig:{beaconName:"searchYourPhotosResultClick",itemIndexKey:"vespaRnk"}},measureAFT:!0,mobileLayout:i.allowMobileLayout?{}:null,layout:{containerPadding:{top:0,right:0,bottom:0,left:0},targetRowHeight:t[i.viewType].rowHeight*r,maxNumRows:1,alwaysDisplayOrphans:!0}},a&&(i.photoListConfig.layout.forceAspectRatio=a),s){if(i.photoListConfig.subviewMapping=s,!this.appContext.flipper.isFlipped("enable-similarity-search"))for(h in s)i.photoListConfig.subviewMapping[h].params&&(i.photoListConfig.subviewMapping[h].params.searchSimilar=!1);if(!this.appContext.flipper.isFlipped("enable-similarity-search-with-term"))for(h in s)i.photoListConfig.subviewMapping[h].params&&(i.photoListConfig.subviewMapping[h].params.searchSimilarWithTerm=!1)}return o&&(i.photoListConfig.layout.itemSpacing=o),i.viewType===e.Models["person-preferences-models"].UNIFIED_SEARCH_VIEW_TYPES.justified&&(i.photoListConfig.layout.itemSpacing={horizontal:4,vertical:4}),this.rowHeightMod=i.rowHeightMod,this},subviewConfig:{"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){var i=this;return this.apiFailed?e.Promise.resolve():this.appContext.getModel("search-photos-lite-models",this.searchId||this.searchUrl.getId(),this.fetchParams).then(function(e){i.searchModel=e,e.getValue("totalItems")<=0&&(i.emptySearch=!0)})},buildContainer:function(){return this.setContainerWithTemplate("search-photos-single-row",{emptySearch:this.emptySearch,total:this.searchModel.getValue("totalItems"),singleResult:1===this.searchModel.getValue("totalItems"),viewAll:this.searchUrl.clone().setAPIParam(e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll,!0).getURL(),viewAllDataTrack:"search-viewall-user",title:this.title||this.intlMessage({intlName:"search.YOUR_PHOTOS"})}),this},buildHeadContainer:function(){this.set("headContainer",this.subviews["photo-list-view"].get("headContainer"))},activate:function(){return this},onParentViewEvent:function(e,i){switch(i&&i.length&&i[0]){case"search:layoutChange":i[1]&&this.handleLayoutChange(i[1])}},handleLayoutChange:function(i){var a,s=this.subviews["photo-list-view"],o=s.photoListLayout,r=t[i].forceAspectRatio,h=e.clone(t[i].subviewMapping),l=this.rowHeightMod;if(t.hasOwnProperty(i)){if("til"===i&&(l=Math.max(1,l)),o.targetRowHeight=t[i].rowHeight*l,o.forceAspectRatio=r,s.subviewMapping=h,!this.appContext.flipper.isFlipped("search-exclude-people"))for(a in h)s.subviewMapping[a].params.excludePeople=!1;if(!this.appContext.flipper.isFlipped("enable-similarity-search"))for(a in h)s.subviewMapping[a].params.searchSimilar=!1;if(!this.appContext.flipper.isFlipped("enable-similarity-search-with-term"))for(a in h)s.subviewMapping[a].params.searchSimilarWithTerm=!1;s.setItems(this.searchModel.getValue("photos").getList())}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-search-photos-single-row","photo-list-view","search-photos-lite-models","search-helper","person-preferences-models"],langBundles:["search","common"]});YUI.add("search-photos-contacts-view",function(e){var i={"photo-models":{name:"photo-list-photo-view",params:{excludePeople:!0,searchSimilar:!0,searchSimilarWithTerm:!0}},"photo-lite-models":{name:"photo-list-photo-view",params:{excludePeople:!0,searchSimilar:!0,searchSimilarWithTerm:!0}}},t={jst:{rowHeight:150,subviewMapping:i},thm:{rowHeight:120,forceAspectRatio:1,subviewMapping:i},til:{rowHeight:210,forceAspectRatio:1,subviewMapping:{"photo-models":{name:"photo-list-tile-view",params:{excludePeople:!0,showDescription:!1,searchSimilar:!0,searchSimilarWithTerm:!0}},"photo-lite-models":{name:"photo-list-tile-view",params:{excludePeople:!0,showDescription:!1,searchSimilar:!0,searchSimilarWithTerm:!0}}}},desc:{rowHeight:210,itemSpacing:{horizontal:4,vertical:70},subviewMapping:{"photo-models":{name:"photo-list-description-view"},"photo-lite-models":{name:"photo-list-description-view"}}}};e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,emptySearch:!1,initializer:function(i){var a,s,o,r,h;if(r=i.rowHeightMod||1,"til"===i.viewType&&(r=Math.max(1,i.rowHeightMod)),this.unifiedSubviewParams=i.unifiedSubviewParams||{},this.unifiedSubviewParams.contacts&&this.unifiedSubviewParams.contacts.fetchParams?(this.fetchParams=this.unifiedSubviewParams.contacts.fetchParams,this.apiParams=e.merge(this.fetchParams.apiParams||{}),this.searchId=this.unifiedSubviewParams.contacts.id,this.title=this.unifiedSubviewParams.contacts.title):(this.apiParams={},this.fetchParams={}),""===this.get("container").get("innerHTML")&&this.setContainerWithTemplate("search-photos-single-row",{loading:!0,title:this.title||this.intlMessage({intlName:"search.FROM_PEOPLE_YOU_FOLLOW"}),placeholderHeight:t[i.viewType].rowHeight*r}),this.searchUrl=new e.SearchUrl(this.apiParams,this.appContext,e.SearchUrl.searchTypes.PHOTOS),a=t[i.viewType].forceAspectRatio,s=e.clone(t[i.viewType].subviewMapping),o=e.clone(t[i.viewType].itemSpacing),i.photoListConfig={modelParams:{registryName:"search-photos-lite-models",modelIdOrAttributes:this.searchId||this.searchUrl.getId(),collectionAttributeName:"photos",fetchParams:this.fetchParams},pageParams:e.merge(this.fetchParams),paginateOnScroll:!1,keepAwakeOnScroll:!0,parentName:this.name,engagementModelName:"photo-lite-models",injectPhotolistContextParams:{rapidBeaconConfig:{beaconName:"searchContactsPhotoResultClick",itemIndexKey:"vespaRnk"}},measureAFT:!0,mobileLayout:i.allowMobileLayout?{}:null,layout:{containerPadding:{top:0,right:0,bottom:0,left:0},targetRowHeight:t[i.viewType].rowHeight*r,maxNumRows:1,alwaysDisplayOrphans:!0}},a&&(i.photoListConfig.layout.forceAspectRatio=a),s){if(i.photoListConfig.subviewMapping=s,!this.appContext.flipper.isFlipped("search-exclude-people")||i.suppressExcludePeople)for(h in s)i.photoListConfig.subviewMapping[h].params&&(i.photoListConfig.subviewMapping[h].params.excludePeople=!1);if(!this.appContext.flipper.isFlipped("enable-similarity-search"))for(h in s)i.photoListConfig.subviewMapping[h].params&&(i.photoListConfig.subviewMapping[h].params.searchSimilar=!1);if(!this.appContext.flipper.isFlipped("enable-similarity-search-with-term"))for(h in s)i.photoListConfig.subviewMapping[h].params&&(i.photoListConfig.subviewMapping[h].params.searchSimilarWithTerm=!1)}return o&&(i.photoListConfig.layout.itemSpacing=o),i.viewType===e.Models["person-preferences-models"].UNIFIED_SEARCH_VIEW_TYPES.justified&&(i.photoListConfig.layout.itemSpacing={horizontal:4,vertical:4}),this.rowHeightMod=i.rowHeightMod,this},subviewConfig:{"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){var i=this;return this.apiFailed?e.Promise.resolve():this.appContext.getModel("search-photos-lite-models",this.searchId||this.searchUrl.getId(),this.fetchParams).then(function(e){i.searchModel=e,e.getValue("totalItems")<=0&&(i.emptySearch=!0)})},buildContainer:function(){return this.setContainerWithTemplate("search-photos-single-row",{emptySearch:this.emptySearch,total:this.searchModel.getValue("totalItems"),singleResult:1===this.searchModel.getValue("totalItems"),viewAll:this.searchUrl.clone().setAPIParam(e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll,!0).getURL(),viewAllDataTrack:"search-viewall-contacts","photo-list-view":this.subviews["photo-list-view"].get("container"),title:this.title||this.intlMessage({intlName:"search.FROM_PEOPLE_YOU_FOLLOW"})}),this},buildHeadContainer:function(){this.set("headContainer",this.subviews["photo-list-view"].get("headContainer"))},activate:function(){return this},onParentViewEvent:function(e,i){switch(i&&i.length&&i[0]){case"search:layoutChange":i[1]&&this.handleLayoutChange(i[1])}},handleLayoutChange:function(i){var a,s=this.subviews["photo-list-view"],o=s.photoListLayout,r=t[i].forceAspectRatio,h=e.clone(t[i].subviewMapping),p=this.rowHeightMod;if(t.hasOwnProperty(i)){if("til"===i&&(p=Math.max(1,p)),o.targetRowHeight=t[i].rowHeight*p,o.forceAspectRatio=r,s.subviewMapping=h,!this.appContext.flipper.isFlipped("search-exclude-people"))for(a in h)s.subviewMapping[a].params.excludePeople=!1;if(!this.appContext.flipper.isFlipped("enable-similarity-search"))for(a in h)s.subviewMapping[a].params.searchSimilar=!1;if(!this.appContext.flipper.isFlipped("enable-similarity-search-with-term"))for(a in h)s.subviewMapping[a].params.searchSimilarWithTerm=!1;s.setItems(this.searchModel.getValue("photos").getList())}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-search-photos-single-row","photo-list-view","search-photos-lite-models","search-helper","person-preferences-models"],langBundles:["search","common"]});YUI.add("hermes-template-search-filter-tools",function(e,a){var s=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,s,r,l){var n,i=null!=a?a:{},t=s.helperMissing,o=e.escapeExpression;return'<div class="dropdown-link filter-license"><p class="option-header">'+o("function"==typeof(n=null!=(n=s.license||(null!=a?a.license:a))?n:t)?n.call(i,{name:"license",hash:{},data:l}):n)+'</p><span class="dropdown-arrow"></span></div>\n<div class="dropdown-link filter-safe-search"><p class="option-header">'+o("function"==typeof(n=null!=(n=s.safeSearch||(null!=a?a.safeSearch:a))?n:t)?n.call(i,{name:"safeSearch",hash:{},data:l}):n)+'</p><span class="dropdown-arrow"></span></div>\n'},useData:!0}),r={};e.Array.each([],function(a){var s=e.Template.get("hermes/"+a);s&&(r[a]=s)}),e.Template.register("hermes/search-filter-tools",function(a,l){return l=l||{},l.partials=l.partials?e.merge(r,l.partials):r,s(a,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("search-filter-tools-view",function(e){var t=[{intlKey:"search.ANY_LICENSE",value:"any",isDefault:!0},{intlKey:"search.ALL_CC",value:"2,3,4,5,6,9"},{intlKey:"search.COMMERCIAL_USE",value:"4,5,6,9,10"},{intlKey:"search.MODS_ALLOWED",value:"1,2,9,10"},{intlKey:"search.COMMERCIAL_USE_MODS",value:"4,5,9,10"},{intlKey:"search.NO_RESTRICTIONS",value:"7,9,10",isCommonsLicense:!0},{intlKey:"search.PUBLIC_DOMAIN_DEDICATION",value:"9",notInDropdown:!0},{intlKey:"search.PUBLIC_DOMAIN_WORK",value:"10",notInDropdown:!0},{intlKey:"search.US_GOVT",value:"8"}],s=[{intlKey:"search.SAFESEARCH_ON",value:"1",prefValue:0,isDefault:!0},{intlKey:"search.SAFESEARCH_MODERATE",value:"2",prefValue:1},{intlKey:"search.SAFESEARCH_OFF",value:"3",prefValue:2}];e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(a){var r,i,n,l,c,h,o=this;return this.searchUrl=a.searchUrl?a.searchUrl.clone():new e.SearchUrl({},this.appContext,e.SearchUrl.searchTypes.PHOTOS),r=this.searchUrl.getAPIParam(e.SearchHelper.API.safeSearch),i=this.searchUrl.getAPIParam(e.SearchHelper.API.license),h=this.searchUrl.getAPIParam(e.SearchHelper.API.commons),i&&(n=e.SearchHelper.deriveCCLicenseString(this.searchUrl.getAPIParams()))&&this.set("selectedLicenseText",this.intlMessage(n)),this.safeSearches=[],s.forEach(function(t){l=e.merge(t,{text:o.intlMessage({intlName:t.intlKey})}),r?l.value===r&&(l.isSelected=!0,o.set("selectedSafeSearch",l.value),o.set("selectedSafeSearchText",l.text),o.usedAPISafeSearch=!0):l.isDefault&&(l.isSelected=!0,o.set("selectedSafeSearch",l.value),o.set("selectedSafeSearchText",l.text)),o.safeSearches.push(l)}),this.licenses=[],t.forEach(function(t){c=e.merge(t,{text:o.intlMessage({intlName:t.intlKey})}),t.itemFlag&&(c.itemFlag=o.intlMessage({intlName:t.itemFlag})),i?c.value===i&&(c.isSelected=!0,o.set("selectedLicense",c.value),o.set("selectedLicenseText",c.text)):"true"===h||parseInt(h)?c.isCommonsLicense&&(c.isSelected=!0,o.set("selectedLicense",c.value),o.set("selectedLicenseText",c.text)):c.isDefault&&!o.searchUrl.getAPIParam(e.SearchHelper.API.marketplace)&&(c.isSelected=!0,o.set("selectedLicense",c.value),o.set("selectedLicenseText",c.text)),c&&!c.notInDropdown&&o.licenses.push(c)}),this},loadState:function(){var t=this,s=[];return this.appContext.getViewer().signedIn&&s.push(this.appContext.getModel("person-preferences-models",this.appContext.getViewer().nsid).then(function(e){t.set("viewerPrefsModel",e),t.safeSearches.forEach(function(s){s.isDefault=!1,t.usedAPISafeSearch||(s.isSelected=!1),s.prefValue===e.getValue("safeSearch")&&(t.usedAPISafeSearch||(s.isSelected=!0,t.set("selectedSafeSearch",s.value),t.set("selectedSafeSearchText",s.text)),s.isDefault=!0)})})),e.Promise.all(s)},buildContainer:function(){return this.setContainerWithTemplate("search-filter-tools",{license:this.get("selectedLicenseText"),safeSearch:this.get("selectedSafeSearchText")}),this},activate:function(){return this.registerEventHandler(this.get("container").one(".filter-license").on("click",this.handleFilterLicense.bind(this))),this.registerEventHandler(this.get("container").one(".filter-safe-search").on("click",this.handleFilterSafeSearch.bind(this))),this},handleFilterLicense:function(t){var s=this;t.halt(),this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target.one(".dropdown-arrow"),positionFixed:!0,closeOnScroll:!0,preferBottom:!0,anchorOffsetHorizontal:15,menuItems:this.licenses}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",function(e){e&&e.menuItem&&e.menuItem.value!==s.get("selectedLicense")&&(s.set("selectedLicense",e.menuItem.value),s.set("selectedLicenseText",e.menuItem.text),s.get("container").one(".filter-license p").set("text",s.get("selectedLicenseText")),s.processUpdate()),s.dropdown.close()}))},handleFilterSafeSearch:function(t){var s=this;t.halt(),this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:t.target.one(".dropdown-arrow"),positionFixed:!0,closeOnScroll:!0,preferBottom:!0,anchorOffsetHorizontal:15,menuItems:this.safeSearches}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",function(e){if(e&&e.menuItem){if(!this.appContext.getViewer().signedIn&&(2===parseInt(e.menuItem.value,10)||3===parseInt(e.menuItem.value,10))&&this.appContext.flipper.isFlipped("enable-signed-out-cta-test"))return s.showSignUpModal(),void s.dropdown.close();s.set("selectedSafeSearch",e.menuItem.value),s.set("selectedSafeSearchText",e.menuItem.text),s.get("container").one(".filter-safe-search p").set("text",s.get("selectedSafeSearchText")),s.processUpdate()}s.dropdown.close()}))},processUpdate:function(){this.isDefaultLicenseValue()?(this.searchUrl.removeAPIParam(e.SearchHelper.API.license),this.searchUrl.removeAPIParam(e.SearchHelper.API.marketplace)):"marketplace"===this.get("selectedLicense")?(this.searchUrl.removeAPIParam(e.SearchHelper.API.license),this.searchUrl.setAPIParam(e.SearchHelper.API.marketplace,"1")):(this.searchUrl.setAPIParam(e.SearchHelper.API.license,this.get("selectedLicense")),this.searchUrl.removeAPIParam(e.SearchHelper.API.marketplace)),this.isDefaultSafeSearchValue()?this.searchUrl.removeAPIParam(e.SearchHelper.API.safeSearch):this.searchUrl.setAPIParam(e.SearchHelper.API.safeSearch,this.get("selectedSafeSearch")),this.fire("subviewViewEvent","search:urlUpdate",this.searchUrl)},isDefaultLicenseValue:function(){var e=this;return this.licenses.reduce(function(t,s){return t||s.isDefault&&s.value===e.get("selectedLicense")},!1)},isDefaultSafeSearchValue:function(){var e=this;return this.safeSearches.reduce(function(t,s){return t||s.isDefault&&s.value===e.get("selectedSafeSearch")},!1)},showSignUpModal:function(){var t,s=e.config.win.location.href,a=this.intlMessage({intlName:"search.SIGN_IN_BEFORE_SEARCH_TITLE"}),r=this.intlMessage({intlName:"search.SIGN_IN_BEFORE_SEARCH_MESSAGE"});(t=new e.Views.SignUpModal({appContext:this.appContext,signUpHeaderClass:"signup-search-mature",signUpTitle:a,signUpMessage:r,beaconPrefix:"searchFilter"})).on("signUpClick",function(t){e.SigninHelper._redirectToSignUp("",{postLoginUrl:s})}),t.on("signInClick",function(t){e.SigninHelper._redirectToSignin("",{postLoginUrl:s})}),t.show()}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-droparound-view","hermes-template-search-filter-tools","search-helper"],langBundles:["search","common"]});YUI.add("hermes-template-search-sort-menu",function(e,a){var r=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,r,s,n){var t;return'<div class="dropdown-link sort-menu"><p class="option-header">'+e.escapeExpression("function"==typeof(t=null!=(t=r.sort||(null!=a?a.sort:a))?t:r.helperMissing)?t.call(null!=a?a:{},{name:"sort",hash:{},data:n}):t)+'</p><span class="dropdown-arrow"></span></div>\n'},useData:!0}),s={};e.Array.each([],function(a){var r=e.Template.get("hermes/"+a);r&&(s[a]=r)}),e.Template.register("hermes/search-sort-menu",function(a,n){return n=n||{},n.partials=n.partials?e.merge(s,n.partials):s,r(a,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});